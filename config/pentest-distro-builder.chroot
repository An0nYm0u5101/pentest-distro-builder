#!/bin/sh

#Populate root's home folder from /etc/skel
cp -rv /etc/skel/. /root/

#Time to git stuff...
cd /root/
git clone https://github.com/Veil-Framework/Veil.git /opt/Veil
git clone https://github.com/leebaird/discover.git /opt/discover
git clone https://github.com/trustedsec/ptf /opt/ptf

ssh-keygen -t rsa -N "" -f ~/.ssh/id_rsa

#Enable/disable our desired services
systemctl enable ssh
systemctl enable cups
systemctl enable apache2
systemctl enable mysql
systemctl enable postgresql
systemctl disable tor
systemctl disable cockpit.socket
systemctl enable xrdp
systemctl disable firewalld

#Allow VLC to run as root
sed -i 's/geteuid/getppid/' /usr/bin/vlc

#Get FTK Imager CLI
wget https://ad-zip.s3.amazonaws.com/ftkimager.3.1.1_ubuntu64.tar.gz
tar xvf ftkimager.3.1.1_ubuntu64.tar.gz
mv ftkimager /usr/bin/
rm ftkimager.3.1.1_ubuntu64.tar.gz

#Install Resilio Sync
wget "https://download-cdn.resilio.com/2.6.4.1344/Debian/resilio-sync_2.6.4.1344-1_amd64.deb"
apt install ./resilio-sync_2.6.4.1344-1_amd64.deb -y

#Install VS Code
wget -qO - https://gitlab.com/paulcarroty/vscodium-deb-rpm-repo/raw/master/pub.gpg | sudo apt-key add -
echo 'deb https://gitlab.com/paulcarroty/vscodium-deb-rpm-repo/raw/repos/debs/ vscodium main' | sudo tee --append /etc/apt/sources.list.d/vscodium.list
sudo apt update && sudo apt install codium -y

#Install VS Code extensions
#codium --install-extension dbaeumer.vscode-eslint --user-data-dir=~/.vscode-oss
#codium --install-extension ecmel.vscode-html-css --user-data-dir=~/.vscode-oss
#codium --install-extension hookyqr.beautify --user-data-dir=~/.vscode-oss
#codium --install-extension ms-azuretools.vscode-docker --user-data-dir=~/.vscode-oss
#codium --install-extension ms-python.python --user-data-dir=~/.vscode-oss
#codium --install-extension ms-vscode.cpptools --user-data-dir=~/.vscode-oss
#codium --install-extension ms-vscode.csharp --user-data-dir=~/.vscode-oss
#codium --install-extension ms-vscode.go --user-data-dir=~/.vscode-oss
#codium --install-extension ms-vscode.powershell --user-data-dir=~/.vscode-oss
#codium --install-extension rebornix.ruby --user-data-dir=~/.vscode-oss
#codium --install-extension zignd.html-css-class-completion --user-data-dir=~/.vscode-oss

#Make Nemo the defualt file manager
xdg-mime default nemo.desktop inode/directory application/x-gnome-saved-search

#Install the REAL Autopsy for Linux.
apt remove sleuthkit autopsy libtsk13 -y
apt install testdisk -y
wget -q -O - https://download.bell-sw.com/pki/GPG-KEY-bellsoft | sudo apt-key add -
echo "deb [arch=amd64] https://apt.bell-sw.com/ stable main" | sudo tee /etc/apt/sources.list.d/bellsoft.list
apt update
apt install bellsoft-java8 -y
export JAVA_HOME=/usr/lib/jvm/bellsoft-java8-amd64/
echo "JAVA_HOME=/usr/lib/jvm/bellsoft-java8-amd64/" >> /etc/environment
wget https://github.com/sleuthkit/sleuthkit/releases/download/sleuthkit-4.7.0/sleuthkit-java_4.7.0-1_amd64.deb
apt install ./sleuthkit-java_4.7.0-1_amd64.deb -y
rm sleuthkit-java_4.7.0-1_amd64.deb
wget https://github.com/sleuthkit/autopsy/releases/download/autopsy-4.13.0/autopsy-4.13.0.zip
unzip autopsy-4.13.0.zip
rm autopsy-4.13.0.zip
mv autopsy-4.13.0 /opt/autopsy
cd /opt/autopsy
chmod +x unix_setup.sh
./unix_setup.sh
cd /usr/bin
ln -s /opt/autopsy/bin/autopsy autopsy

#Distro-specific stuff
DISTRO=$(cat /etc/lsb-release | grep DISTRIB_ID | cut -c 12-30)

case $DISTRO in
Parrot)
#Stop ParrotSec from overwriting all our desktop customizations every time parrot-skel updates. >:-(
apt-mark hold parrot-skel
;;
Kali)
#Remove CPU-hungry MATE menu applet
apt remove mate-applet-brisk-menu -y
;;
esac

